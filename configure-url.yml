- hosts: amazon-*
  become_user: ubuntu
  tasks:
   - name: Editing core.xml File
     
     ansible.builtin.blockinfile:
       dest: /usr/local/hadoop/etc/hadoop/core-site.xml
       marker: "<!-- {mark} ANSIBLE MANAGED BLOCK -->"
       insertafter: "<configuration>"
       block: |
         <property>
         <name>fs.defaultFS</name>
         <value>hdfs://amazon-1:9000</value>
         </property>
       backup: yes
       owner: ubuntu

   - name: Editing mapred.xml File
     
     ansible.builtin.blockinfile:
       dest: /usr/local/hadoop/etc/hadoop/mapred-site.xml
       marker: "<!-- {mark} ANSIBLE MANAGED BLOCK -->"
       insertafter: "<configuration>"
       block: |
         <property>
         <name>mapred.job.tracker</name>
         <value>amazon-1:54311</value>
         </property>
         <property>
         <name>mapreduce.framework.name</name>
         <value>yarn</value>
         </property>
       backup: yes
       owner: ubuntu


   - name: Editing hdfs.xml File
     
     ansible.builtin.blockinfile:
       dest: /usr/local/hadoop/etc/hadoop/hdfs-site.xml
       marker: "<!-- {mark} ANSIBLE MANAGED BLOCK -->"
       insertafter: "<configuration>"
       block: |
         <property>
         <name>dfs.replication</name>
         <value>2</value>
         </property>
         <property>
         <name>dfs.namenode.name.dir</name>
         <value>file:///usr/local/hadoop/hdfs/data</value>
         </property>
         <property>
         <name>dfs.datanode.data.dir</name>
         <value>file:///usr/local/hadoop/hdfs/data</value>
         </property>
         <property>
         <name>dfs.permissions</name>
         <value>false</value>
         </property>
       backup: yes
       owner: ubuntu

   - name: Editing yarn-site.xml File
     
     ansible.builtin.blockinfile:
       dest: /usr/local/hadoop/etc/hadoop/yarn-site.xml
       marker: "<!-- {mark} ANSIBLE MANAGED BLOCK -->"
       insertafter: "<configuration>"
       block: |
         <property>
         <name>yarn.nodemanager.aux-services</name>
         <value>mapreduce_shuffle</value>
         </property>
         <property>
         <name>yarn.nodemanager.aux-services.mapreduce.shuffle.class</name>
         <value>org.apache.hadoop.mapred.ShuffleHandler</value>
         </property>
         <property>
         <name>yarn.resourcemanager.hostname</name>
         <value>amazon-1</value>
         </property>
       backup: yes
       owner: ubuntu

   - name: Removing some lines in slaves start File
     ansible.builtin.lineinfile:
       path: /usr/local/hadoop/etc/hadoop/workers
       regexp: 'localhost'
       line: ''
       backrefs: yes
       owner: ubuntu



   - name: Modifying masters file
     ansible.builtin.blockinfile:
       dest: /usr/local/hadoop/etc/hadoop/masters
       insertafter: EOF
       block: |
         amazon-1
       backup: yes
       owner: ubuntu

   - name: Modifying slaves file
     
     ansible.builtin.blockinfile:
       dest: /usr/local/hadoop/etc/hadoop/workers
       insertafter: EOF
       block: |
         amazon-2
         amazon-3
       backup: yes
       owner: ubuntu
- hosts: amazon-1
  become: yes
  tasks:
   - name: Download drill
     get_url: 
       url:   https://dlcdn.apache.org/drill/drill-1.19.0/apache-drill-1.19.0.tar.gz
       dest: /home/ubuntu
       remote_src: yes
       owner: ubuntu
   - name: Get apache zeppelin
     unarchive: 
       src: hhttps://dlcdn.apache.org/zeppelin/zeppelin-0.10.1/zeppelin-0.10.1-bin-all.tgz
       dest: /home/ubuntu
       remote_src: True 
       owner: ubuntu          
- hosts: amazon-*
  become: yes
  tasks:
   - name: Changing Hosts file
     get_url: 
       url: https://github.com/suhailshaik98/Configure-Apache-Hadoop/raw/main/hosts
       dest: /etc/hosts
       backup: yes
       owner: ubuntu  
   - name: Rebooting Machines
     reboot:
